# API

## Terminology
`{baseURL}` will refer to the URL for the server (including the port). So if the server is hosted at `www.example.com`, then `{baseURL}` will be `www.example.com:3000`.

**(protected)** means that the method requires authentication to perform the operation. You must supply either an API key or user token with each request. You may request a user token from the server using `login`.

For requests where you intend to use a user token, you must supply the following in the header:
```
Authorization: Token tok
```
Where `tok` is the token string retrieved from the server by using `login`.

For requests where you intend to use an API key, you must supply the following in the header: 
```
Authorization: ApiKey key
```
Where `key` is the API key.


## Annotation JSON structure
When an annotation is returned by the server, it will be in the following JSON structure:

- `data`
    + `beginTime`: Start time in integer milliseconds
    + `endTime`: Stop time in integer milliseconds
    + `pointsArray`: Array of arrays representing a polygon as percent point coordinates in clockwise order. For example, a polygon covering the left half of the video might look like `[["0", "0"], ["50", "0"], ["50", "50"], ["0", "50"]]`
    + `tags`: Array of strings representing video tags
    + `text`: String representing annotation text
- `metadata`
    + `id`: ID of the annotation on the server
    + `location`: URL location of the video source
    + `title`: Title of the video

## Methods

### `getAnnotationsByLocation`
`{baseURL}/api/getAnnotationsByLocation`

Request type: `GET`

Gets an array of annotations for the video at the given URL.

Input JSON:
```json
{
    "location": url
}
```
Where `url` is the video's source URL as a string.

Output JSON:
- `annotations`: An array of annotation objects


### `addAnnotation` (protected)
`{baseURL}/api/addAnnotation`

Request type: `POST`

Input JSON:
- `annotation`: Main text of the annotation
- `video_title`: Title of the video (optional)
- `video_author`: Author of the annotation (optional)
- `location`: URL of the video
- `beginTime`: Start time of the annotation in integer milliseconds
- `endTime`: Stop time of the annotation in integer milliseconds
- `pointsArray`: Array of arrays representing a polygon as percent point coordinates in clockwise order. For example, a polygon covering the left half of the video might look like `[["0", "0"], ["50", "0"], ["50", "50"], ["0", "50"]]`
- `tags`: Array of strings representing tags for the video
- `email`: (Required if using API key) Email address of annotation creator

Output JSON:
- `id`: The ID generated for the new annotation by the server


### `editAnnotation` (protected)
`{baseURL}/api/editAnnotation`

What actually happens here is when an annotation is edited, it is canonically replaced with a clone that has the changes applied. For this reason, when editing an annotation, you must supply all the information needed to generate an entirely new annotation.

Input JSON is the same as for `addAnnotation`, with the following added:
- `id`: The ID of the annotation to be edited

Output JSON:
- `id`: The ID of the new annotation


### `Delete annotation` (protected)
`{baseURL}/api/deleteAnnotation`

Request type: `DELETE`

Input JSON:
- `id`: The ID of the annotation you want to delete

Output JSON:
- None


### `login`
`{baseURL}/api/login`

Request type: `POST`

Logs the user with the given `username` and `password` in. Returns a token generated for the user that should be supplied with all protected requests. Note that you don't need to use this if you're using an API key.

Request Header:
```
Authorization: Basic tk
```
Where `tk` is the Base64 conversion of the string `username + ":" + password`.

Example (username is `test`, password is `pass`): `Authorization: Basic dGVzdDpwYXNz`

Input JSON:
- None

Output JSON:
- `auth_token`: The token generated by the server. Use for all protected requests.


### `logout` (protected)
`{baseURL}/api/logout`

Request type: `DELETE`

Logs the user with the supplied token out.

Input JSON:
- None

Output JSON:
- None

